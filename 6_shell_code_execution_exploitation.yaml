title: Find Command Shell Code Execution Exploitation
description: Create a detection rule to identify suspicious behavior where shell execution occurs through the find commandâ€™s -exec parameter. You need to focus on combinations of the find command with the -exec parameter followed by shell program execution (such as /bin/sh, /bin/bash, etc.) or commands that might lead to code execution. Be sure to capture different variants while balancing detection rates and false positives.
status: experimental
author: Luca Vaudano
level: medium
logsource:
    product: any
    category: any
detection:
    selection_find_binary:
        Image|contains:
            - '/usr/bin/find'
            - '/bin/find'
            - 'find'
    
    selection_exec_param:
        CommandLine|contains:
            - ' -exec '
            - ' --exec '
    
    selection_shell_execution:
        CommandLine|contains:
            - '/bin/sh'
            - '/bin/bash'
            - '/bin/dash'
            - '/bin/zsh'
            - '/bin/csh'
            - '/bin/tcsh'
            - '/bin/ksh'
            - 'sh -c'
            - 'bash -c'
            - 'sh -i'
            - 'bash -i'
    
    selection_suspicious_commands:
        CommandLine|contains:
            - '-exec python'
            - '-exec perl'
            - '-exec ruby'
            - '-exec php'
            - '-exec node'
            - '-exec curl'
            - '-exec wget'
            - '-exec nc '
            - '-exec netcat'
            - '-exec chmod +x'
            - '-exec rm -rf'
            - '-exec dd if='
            - '-exec base64'
    
    # Alternative pattern for cases where find and -exec appear together
    selection_combined_pattern:
        CommandLine|contains:
            - 'find*-exec*/bin/'
            - 'find*-exec*sh*'
            - 'find*-exec*bash*'
    
    condition: selection_find_binary and selection_exec_param and (selection_shell_execution or selection_suspicious_commands or selection_combined_pattern)